# AI分类流程详细说明（已改进）

## 改进后的分类流程

### 1. 数据预处理
- 过滤无意义页面（如 New Tab、登录页面等）
- 规范化域名（去除www前缀等）
- 添加时间段信息

### 2. 规则分类（第一阶段）
- 使用预定义的域名映射表进行分类（8个主要类别）
- 使用关键词匹配进行补充分类
- 无法匹配的归入"其他"类别

### 3. AI增强分类（第二阶段）✨ 已改进
**触发条件（已优化）：**
- 启用了AI分类功能
- 配置了API Key
- 规则分类覆盖率低于60%（原80%） 或 未分类条目超过3个

**AI分类处理流程：**
1. 提取所有被规则分类为"其他"的条目
2. 使用改进的提示词发送给AI模型
3. AI尝试将这些条目重新分配到8个预设类别中
4. 记录分类效果统计

### 4. 结果合并与展示 ✨ 新增
- 将AI分类结果与规则分类结果智能合并
- 计算AI分类改进效果
- 显示详细的分类统计信息
- 为"其他"类别提供特殊说明

## 改进内容

### ✅ 已解决的问题

1. **降低AI分类触发阈值**
   - 从80%降低到60%
   - 增加条件：未分类条目超过3个就触发AI分类

2. **增强AI分类提示词**
   - 更清晰的分类指导
   - 强调减少"其他"类别的目标
   - 添加语义理解和宽松分类策略

3. **改进错误处理**
   - 更好的网络错误处理
   - JSON解析错误的多层修复
   - 优雅的降级机制

4. **增强用户反馈**
   - 显示AI分类状态
   - 展示分类改进效果
   - 为"其他"类别添加说明

5. **UI优化**
   - 修复按钮样式一致性
   - 添加AI分类效果展示
   - 特殊标识"其他"类别

### 🔄 AI分类的具体处理方式

**对于"其他"类别的网站，AI会：**

1. **分析域名特征** - 根据域名判断网站类型
2. **理解页面标题** - 从标题提取关键信息
3. **语义分类** - 理解网站的实际用途
4. **宽松匹配** - 优先分配到合适类别而非"其他"

**示例：**
- `example-blog.com` + 标题"技术分享" → 可能分类到"新闻与资讯"
- `unknown-tool.io` + 标题"API Documentation" → 可能分类到"编程与开发"
- `random-site.net` + 标题"在线购物" → 可能分类到"生活与消费"

### 📊 分类效果展示

现在用户可以看到：
- 原始"其他"条目数量
- AI成功重分类的数量
- 剩余"其他"条目数量
- 分类改进率百分比

### 💡 用户建议

对于仍然无法分类的网站，系统会提示用户：
- 可以在设置中添加自定义规则
- 联系开发者改进分类算法
- 这些网站可能确实属于特殊类别

## 技术实现细节

- **触发阈值**：覆盖率 < 60% 或 未分类 > 3个
- **AI模型**：使用小模型（如gpt-3.5-turbo）进行分类
- **错误处理**：多层JSON解析修复 + 网络错误处理
- **降级机制**：AI失败时自动使用规则分类结果